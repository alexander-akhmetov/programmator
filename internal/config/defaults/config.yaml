# Programmator Configuration
# This file defines the default configuration for programmator.
# Override at:
#   - Global: ~/.config/programmator/config.yaml
#   - Local:  .programmator/config.yaml (project-specific)

# Loop settings
max_iterations: 50        # Maximum loop iterations before forced exit
stagnation_limit: 3       # Exit after N consecutive iterations with no file changes
timeout: 900              # Seconds per Claude invocation

# Claude settings
claude_flags: ""          # Additional flags passed to claude command
claude_config_dir: ""     # Custom Claude config directory (empty = default)
anthropic_api_key: ""     # Anthropic API key to pass to Claude (filters inherited ANTHROPIC_API_KEY)

# Ticket settings
ticket_command: "tk"      # Binary name for the ticket CLI (tk or ticket)

# Progress log settings
logs_dir: ""              # Directory for progress logs (default: ~/.programmator/logs)

# Git workflow settings
git:
  auto_commit: false         # Auto-commit after each phase completion
  move_completed_plans: false # Move completed plans to completed/ directory
  completed_plans_dir: ""    # Directory for completed plans (default: plans/completed)
  branch_prefix: ""          # Prefix for auto-created branches (default: programmator/)

# Codex review settings
codex:
  enabled: true
  command: "codex"
  model: "gpt-5.2-codex"
  reasoning_effort: "xhigh"
  timeout_ms: 3600000
  sandbox: "read-only"
  error_patterns:
    - "Rate limit"
    - "quota exceeded"

# Review settings
review:
  max_iterations: 50      # Maximum review fix iterations (used as base for iteration_pct)

  phases:
    # Phase 1: Comprehensive review - run all 6 agents once
    - name: comprehensive
      iteration_limit: 5    # Fix-and-verify cycles before moving to next phase
      parallel: true
      validate: true
      agents:
        - name: quality
          focus:
            - error handling
            - code clarity
            - resource management
            - concurrency
        - name: security
          focus:
            - input validation
            - secrets
            - injection
        - name: implementation
          focus:
            - requirement coverage
            - wiring
            - completeness
        - name: testing
          focus:
            - test coverage
            - fake tests
            - edge cases
        - name: simplification
          focus:
            - over-engineering
            - unnecessary abstractions
        - name: linter
          focus:
            - lint errors
            - formatting
            - static analysis

    # Phase 2: Critical loop - focus on high-severity issues
    - name: critical_loop
      iteration_pct: 10     # max(3, maxIter*10/100) = max(3, 5) = 5
      severity_filter:
        - critical
        - high
      parallel: true
      validate: true
      agents:
        - name: quality
          focus:
            - bugs
            - security
            - race conditions
            - error handling
        - name: implementation
          focus:
            - correctness
            - completeness

    # Phase 3: Final check - last verification of critical issues
    - name: final_check
      iteration_pct: 10
      severity_filter:
        - critical
        - high
      parallel: true
      validate: true
      agents:
        - name: quality
          focus:
            - bugs
            - security
            - race conditions
            - error handling
        - name: implementation
          focus:
            - correctness
            - completeness
